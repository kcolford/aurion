#!/bin/sh
aur=aur.archlinux.org
[ "$1" ] || exit
d="$(dirname "$1")"
b="$(basename "$1")"
case "$d" in
    aur|my-aur)
	if [ -d "$1" ]
	then
	    git submodule update --init --recursive "$1"
	    git -C "$1" checkout master
	    git -C "$1" pull
	else
	    git submodule add https://$aur/"$b" "$1"
	fi
	if [ "$d" = my-aur ]; then
	    git -C "$1" config url.ssh://aur@$aur/"$b".pushInsteadOf https://$aur/"$b"
	fi
	excludefile=.git/modules/"$1"/info/exclude
	;;
    core|extra|community)
	ABSROOT=. abs "$d/$b"
	;;
esac
touch "${excludefile:=$1/.gitignore}"
# shellcheck disable=SC2041
for exclude in '*.pkg.tar*'; do
    if ! fgrep -q "$exclude" < "$excludefile"; then
	echo "$exclude" >> "$excludefile"
    fi
done
